<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Custom Families in 'brms' Models</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for custom_family {brms}"><tr><td>custom_family {brms}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Custom Families in <span class="pkg">brms</span> Models</h2>

<h3>Description</h3>

<p>Define custom families for use in <span class="pkg">brms</span> models.
It allows users to benefit from the modeling flexibility of 
<span class="pkg">brms</span>, while applying their self-defined likelihood
functions. All of the post-processing methods for <code>brmsfit</code> 
objects can be made compatible with custom families. 
See <code>vignette("brms_customfamilies")</code> for more details.
For a list of built-in families see <code><a href="brmsfamily.html">brmsfamily</a></code>.
</p>


<h3>Usage</h3>

<pre>
custom_family(name, dpars = "mu", links = "identity", type = c("real",
  "int"), lb = NA, ub = NA, vars = NULL, env = parent.frame())
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>name</code></td>
<td>
<p>Name of the custom family.</p>
</td></tr>
<tr valign="top"><td><code>dpars</code></td>
<td>
<p>Names of the distributional parameters of
the family. One parameter must be named <code>"mu"</code> and
the main formula of the model will correspond to that
parameter.</p>
</td></tr>
<tr valign="top"><td><code>links</code></td>
<td>
<p>Names of the link functions of the 
distributional parameters.</p>
</td></tr>
<tr valign="top"><td><code>type</code></td>
<td>
<p>Indicates if the response distribution is
continuous (<code>"real"</code>) or discrete (<code>"int"</code>).</p>
</td></tr>
<tr valign="top"><td><code>lb</code></td>
<td>
<p>Vector of lower bounds of the distributional 
parameters. Defaults to <code>NA</code> that is no lower bound.</p>
</td></tr>
<tr valign="top"><td><code>ub</code></td>
<td>
<p>Vector of upper bounds of the distributional 
parameters. Defaults to <code>NA</code> that is no upper bound.</p>
</td></tr>
<tr valign="top"><td><code>vars</code></td>
<td>
<p>Names of variables, which are part of the likelihood
function without being distributional parameters. That is,
<code>vars</code> can be used to pass data to the likelihood. 
See <code><a href="stanvar.html">stanvar</a></code> for details about adding self-defined
data to the generated <span class="pkg">Stan</span> model.</p>
</td></tr>
<tr valign="top"><td><code>env</code></td>
<td>
<p>An <code><a href="../../base/html/environment.html">environment</a></code> in which certain post-processing 
functions related to the custom family can be found. This is only
relevant if one wants to ensure compatibility with the methods
<code><a href="predict.brmsfit.html">predict</a></code>, 
<code><a href="fitted.brmsfit.html">fitted</a></code>, or
<code><a href="log_lik.brmsfit.html">log_lik</a></code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The corresponding probability density or mass <code>Stan</code> 
functions need to have the same name as the custom family.
That is if a family is called <code>myfamily</code>, then the 
<span class="pkg">Stan</span> functions should be called <code>myfamily_lpdf</code> or
<code>myfamily_lpmf</code> depending on whether it defines a 
continuous or discrete distribution.
</p>


<h3>Value</h3>

<p>An object of class <code>customfamily</code> inheriting
for class <code><a href="brmsfamily.html">brmsfamily</a></code>.
</p>


<h3>See Also</h3>

<p><code><a href="brmsfamily.html">brmsfamily</a></code>, <code><a href="stanvar.html">stanvar</a></code>
</p>


<h3>Examples</h3>

<pre>
## Not run: 
## demonstrate how to fit a beta-binomial model
## generate some fake data
phi &lt;- 0.7
n &lt;- 300
z &lt;- rnorm(n, sd = 0.2)
ntrials &lt;- sample(1:10, n, replace = TRUE)
eta &lt;- 1 + z
mu &lt;- exp(eta) / (1 + exp(eta))
a &lt;- mu * phi
b &lt;- (1 - mu) * phi
p &lt;- rbeta(n, a, b)
y &lt;- rbinom(n, ntrials, p)
dat &lt;- data.frame(y, z, ntrials)

# define a custom family
beta_binomial2 &lt;- custom_family(
  "beta_binomial2", dpars = c("mu", "phi"),
  links = c("logit", "log"), lb = c(NA, 0),
  type = "int", vars = "trials[n]"
)

# define the corresponding Stan density function
stan_funs &lt;- "
  real beta_binomial2_lpmf(int y, real mu, real phi, int N) {
    return beta_binomial_lpmf(y | N, mu * phi, (1 - mu) * phi);
  }
"

# fit the model
fit &lt;- brm(y | trials(ntrials) ~ z, data = dat, 
           family = beta_binomial2, stan_funs = stan_funs)
summary(fit)

## End(Not run)

</pre>

<hr /><div style="text-align: center;">[Package <em>brms</em> version 2.3.0 <a href="00Index.html">Index</a>]</div>
</body></html>
